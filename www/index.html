<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mobile App Framework</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Supabase client library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            max-width: 500px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #f8f9fa;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.2);
            position: relative;
            /* Remove overflow: hidden; */
        }

        .app-header {
            background: linear-gradient(to right, #4b6cb7, #182848);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 10;
            flex-shrink: 0;
            height: 60px;
        }

        .app-header h1 {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .page-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            /* Remove overflow: hidden; */
        }

        .page {
            display: none;
            height: calc(100vh - 60px - 60px); /* header + tab bar */
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            padding-bottom: 70px;
            box-sizing: border-box;
            /* Remove opacity/transform transitions for simplicity */
        }
        .page.active {
            display: block;
        }

        .page h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .page-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .tab-bar {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            height: 60px;
            z-index: 100;
            display: flex;
            background: white;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            border-top: 1px solid #ddd;
        }

        .tab {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 12px 5px;
            color: #7f8c8d;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab i {
            font-size: 1.4rem;
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #3498db;
            background: rgba(52, 152, 219, 0.05);
        }

        .tab.active i {
            transform: translateY(-5px);
            text-shadow: 0 5px 10px rgba(52, 152, 219, 0.3);
        }

        /* Home Page Styles */
        .welcome-card {
            text-align: center;
            padding: 30px 20px;
        }

        .welcome-card i {
            font-size: 3rem;
            color: #3498db;
            margin-bottom: 20px;
        }

        /* Info Card Styles */
        .info-card {
            cursor: pointer;
            transition: transform 0.3s;
            padding: 20px;
            border-radius: 10px;
            background: #f1f8ff;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.1);
            margin-bottom: 15px;
        }

        .info-card:hover {
            transform: translateY(-3px);
        }

        .info-card h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .info-card p {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        /* Checklist Page Styles */
        .add-task {
            display: flex;
            margin-bottom: 20px;
        }

        .add-task input {
            flex: 1;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px 0 0 10px;
            font-size: 1rem;
        }

        .add-task button {
            padding: 0 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 0 10px 10px 0;
            cursor: pointer;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .task-item input[type="checkbox"] {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .task-content {
            flex: 1;
        }

        .task-content h3 {
            margin-bottom: 5px;
            color: #2c3e50;
        }

        .task-content p {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .task-item.completed .task-content h3,
        .task-item.completed .task-content p {
            text-decoration: line-through;
            color: #95a5a6;
        }

        /* Notifications Page Styles */
        .notification-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .notification-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .notification-item i {
            font-size: 24px;
            margin-right: 15px;
            color: #3498db;
        }

        .notification-content {
            flex: 1;
        }

        .notification-content h3 {
            margin-bottom: 5px;
            color: #2c3e50;
        }

        .notification-content p {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .notification-time {
            color: #95a5a6;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        /* Login Page Styles */
        .login-form {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .btn {
            display: block;
            width: 100%;
            padding: 14px;
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .additional-options {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .additional-options a {
            color: #3498db;
            text-decoration: none;
        }

        .social-login {
            margin-top: 30px;
            text-align: center;
        }

        .social-login p {
            position: relative;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .social-login p::before,
        .social-login p::after {
            content: "";
            position: absolute;
            top: 50%;
            width: 30%;
            height: 1px;
            background: #e0e0e0;
        }

        .social-login p::before {
            left: 0;
        }

        .social-login p::after {
            right: 0;
        }

        .social-icons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .social-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .social-icon:hover {
            transform: translateY(-5px);
        }

        .facebook {
            background: linear-gradient(to right, #3b5998, #4867aa);
        }

        .google {
            background: linear-gradient(to right, #dd4b39, #ea4335);
        }

        .twitter {
            background: linear-gradient(to right, #1da1f2, #1a91da);
        }

        /* Profile Page Styles */
        .profile-section {
            text-align: center;
        }

        .profile-avatar img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .profile-info h3 {
            margin: 10px 0;
            color: #2c3e50;
        }

        .profile-info p {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        /* Checklist Page Styles - Updated */
        .checklist-month {
            margin-bottom: 30px;
        }

        .checklist-month h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.2rem;
            position: relative;
        }

        .checklist-month h3::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, #3498db, #6a11cb);
            bottom: -5px;
            left: 0;
        }

        /* Progress Bar Styles */
        #checklist-progress-container {
            margin-bottom: 20px;
        }

        #checklist-progress-label {
            font-weight: 500;
            color: #2c3e50;
        }

        #checklist-progress-percent {
            font-weight: 600;
            color: #3498db;
        }

        #checklist-progress-bar {
            height: 8px;
            background: linear-gradient(90deg, #3498db, #6a11cb);
            border-radius: 4px;
            transition: width 0.3s;
        }

       

        .create-account-form {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            max-width: 400px;
            margin: auto;
            padding: 30px;
            position: relative;
        }

        .create-account-form h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
        }

        .create-account-form .form-group {
            margin-bottom: 15px;
        }

        .create-account-form .form-group label {
            margin-bottom: 5px;
            color: #2c3e50;
            font-weight: 500;
            display: block;
        }

        .create-account-form .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .create-account-form .form-control:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .create-account-form .btn {
            display: block;
            width: 100%;
            padding: 12px;
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }

        .create-account-form .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
        }

        .create-account-form .btn:active {
            transform: translateY(0);
        }

        .create-account-form #ca-cancel {
            background: #eee;
            color: #333;
            margin-top: 10px;
        }

        .create-account-form #ca-cancel:hover {
            background: #ddd;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="app-header">
            <h1>Mobile App Framework</h1>
        </div>

        <div class="page-container">
            <!-- Login Page (now first page) -->
            <div id="login-page" class="page active">
                <h2>Account Login</h2>
                <div class="page-content">
                    <div class="login-form">
                        <h2>Welcome Back</h2>
                        <form id="login-form">
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="text" id="email" class="form-control" placeholder="Enter your email" required>
                            </div>
                            <div class="form-group">
                                <label for="password">Password</label>
                                <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                            </div>
                            <button type="submit" class="btn">Login</button>
                            <div class="additional-options">
                                <a href="#">Forgot Password?</a>
                                <a href="#">Create Account</a>
                            </div>
                            <div class="social-login">
                                <p>Or continue with</p>
                                <div class="social-icons">
                                    <div class="social-icon facebook">
                                        <i class="fab fa-facebook-f"></i>
                                    </div>
                                    <div class="social-icon google">
                                        <i class="fab fa-google"></i>
                                    </div>
                                    <div class="social-icon twitter">
                                        <i class="fab fa-twitter"></i>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Home Page -->
            <div id="home-page" class="page">
                <h2>Dashboard</h2>
                <div class="page-content welcome-card">
                    <img src="img/icanlogo.jpg" alt="ICAN Logo" style="width:180px; height:180px; display:block; margin:0 auto 24px auto; border-radius:24px; box-shadow:0 2px 16px rgba(0,0,0,0.12);">
                    <h2>Welcome to Iowa College Access Network</h2>
                    <p>Your Portal For Navigating Your Career Entry Journey</p>
                </div>
                <!-- Info Cards (now just static content) -->
                <div class="page-content info-card" data-info="career-training" >
                    <h3>Career Training Apprenticeship Programs</h3>
                    <p>Apprenticeship and job training programs are options that provide specific career and industry training. On-the-job training Apprenticeships Career-focused certificate and degree programs at a community college or career training center.</p>
                </div>
                <div class="page-content info-card" data-info="academic-planning">
                    <h3>Academic Planning</h3>
                    <p>Success in high school leads to success later in life, whether you choose to continue your education or pursue a career. Find the balance that works for you to start achieving success now.</p>
                </div>
                <div class="page-content info-card" data-info="financial-aid">
                    <h3>Financial Aid</h3>
                    <p>A college education is one of the largest financial investments you'll make for your future. You have a lot of options when it comes to choosing a program and a school that's right for you, all of which cost some money and most of which cost a lot. Fortunately, you also have several options when it comes to managing your financial commitment.<br></p>
                </div>
            </div>

            <!-- Info Pages (hidden by default) -->
            <div id="career-training-info-page" class="page">
                <h2>Career Training Apprenticeship Programs<br></h2>
                <div class="page-content">
                    <p>Four years of college isn’t for everyone and the job market isn’t set up for everyone to need a four-year degree.<br></p>
                    <p>Apprenticeship and job training programs are options that provide specific career and industry training.<br></p>
                    <ul>
                        <li>On-the-job training</li>
                        <li>Apprenticeships</li>
                        <li>Career-focused certificate and degree programs at a community college or career training center</li>
                    </ul>
                    <h3><br>Earn As You Learn<br></h3>
                    <p>The Iowa Building and Construction Trades Registered Apprenticeship Programs are overseen by the U.S. Department of Labor, Bureau of Apprenticeship and Training, and are “earn and learn” curricula that combine on-the-job training with structured learning at no cost to the students. While individual programs and trades vary, in many cases an apprentice student would spend time with experienced professionals on real job sites working and learning the trade. When not on a job, students are in classes. Both on-site and classroom experience provides a paycheck, and while exact figures vary by profession, the average apprentice makes about half of a journeyman’s hourly wage with salary increases every six months, along with health care benefits and the opportunity to enroll in a pension program. Most programs also guarantee a job within the union upon completion of the registered apprenticeship program.<br></p>
                    <p>In addition to experience, a paycheck, and a job guarantee, many apprentice program classes and training can be applied to an associate’s or bachelor’s degree. For transfer credit specifics, talk to your local union representative about how programs can be transferred for college credit and to which colleges the transfer credits are accepted.<br></p>
                    <h3><br>Building Trades Registered Apprenticeship Programs - What Are Your Options?<br></h3>
                    <ul>
                        <li>Boilermakers</li>
                        <li>Bricklayers</li>
                        <li>Carpenters</li>
                        <li>Electricians</li>
                        <li>Elevator Constructors</li>
                        <li>Glaziers</li>
                        <li>Insulators</li>
                        <li>Ironworkers</li>
                        <li>Laborers</li>
                        <li>Linemen</li>
                        <li>Millwrights</li>
                        <li>Operating Engineers</li>
                        <li>Painters & Drywall Finishers</li>
                        <li>Plumbers & Steamfitters</li>
                        <li>Roofers & Waterproofers</li>
                        <li>Sheet Metal Workers</li>
                        <li>Sprinklerfitters</li>
                        <li>Teamsters</li>
                    </ul>
                </div>
            </div>
            <div id="academic-planning-info-page" class="page">
                <h2>Academic Planning<br></h2>
                <div class="page-content">
                    <p>As a high school student, you hear a lot of advice about what it takes to be successful.<br></p>    
                    <ul>
                        <li>Get involved in different activities.</li>
                        <li>Plan for the future.</li>
                        <li>Achieve high grades.</li>
                        <li>Challenge yourself with harder classes.</li>
                        <li>Be responsible.</li>
                        <li>Study hard.</li>
                        <li>Go out and have some fun.</li>
                        <li>Earn some money.</li>
                    </ul>
                    <p><br>So how do you manage those all at the same time? The key is balance. Think of ways to work some of these ideas in with others. For example:<br></p>
                    <ul>
                        <li>To balance classes, take some courses that you know you can get high grades in, a couple of harder classes that will challenge you, and one or two electives that let you explore new options each year.</li>
                        <li>To balance activities, get involved in different organizations that let you have some fun and give you opportunities to be a leader and work as a team.</li>
                        <li>To balance the present with the future, take a part-time job that helps you earn money for the future, shows that you're responsible and gives you experience you can use later.</li>
                    </ul>
                    <p><br>Success in high school leads to success later in life, whether you choose to continue your education or pursue a career. Find the balance that works for you to start achieving success now.<br></p>
                </div>
            </div>
            <div id="financial-aid-info-page" class="page">
                <h2>Financial Aid<br></h2>
                <div class="page-content">
                    <p>A college education is one of the largest financial investments you'll make for your future. You have a lot of options when it comes to choosing a program and a school that's right for you, all of which cost some money and most of which cost a lot. Fortunately, you also have several options when it comes to managing your financial commitment.<br></p>
                    <h3><br>The money you spend now is an investment<br></h3>
                    <p>According to a report from the Georgetown University Center on Education and the Workforce (CEW), adults with a bachelor’s degree earn an average of $2.8 million during their careers, $1.2 million more than the median for workers with a high school diploma. With costs rising yearly, a semester of college costs less now than it will later on.<br></p>
                    <h3><br>Financial Aid Process<br></h3>
                    <ul>
                        <li>Set a Budget</li>
                        <li>Types of Financial Aid</li>
                        <li>Setup Your StudentAid.gov Account (FSA ID)</li>
                        <li>Apply</li>
                        <li>FAFSA</li>
                        <li>Scholarships & Grants</li>
                        <li>Compare Financial Aid Offers</li>
                        <li>Ask for Advice</li>
                    </ul>
                    <h3><br>Set Your Budget<br></h3>
                    <p>
                        Based on your intended career or program of study, set your budget for college. Research your career's starting salary and understand that if you have to borrow to cover college costs, your borrowing should not exceed your first year's starting salary. Determine the amount of money you have available from savings and investments that can go toward college over the next two to four years. This savings can reduce your borrowing amount and provide flexibility in the schools that you can afford to attend. Estimate your costs by looking at NET price at each Iowa college and university.<br>
                    </p>
                    <h3><br>Types of Financial Aid<br></h3>
                    <p>
                        Financial aid is grants, scholarships, work-study and/or federal loans you qualify for. To apply for aid, you'll need to fill out a Free Application for Federal Student Aid (FAFSA) and submit it to the U.S. Department of Education. The FAFSA is a free form that may be completed without professional assistance via paper or electronic forms provided by the U.S. Department of Education. If you need help, ICAN offers no cost assistance.<br>
                    </p>
                    <ul>
                        <li><p><strong>Grants</strong> are given by the government, schools or organizations to help you pay for college. Grants do not need to be repaid and are usually given based on financial need. Grants are awarded as part of your overall financial aid package.</p></li>
                        <li><p><strong>Scholarships</strong> also don't need to be repaid and are usually given based on financial need or merit (meaning you've earned it by being a good student, a good athlete or meeting some other qualification). Scholarships are awarded by private donors or schools.</p></li>
                        <li><p><strong>Work-Study</strong> involves a part-time job, usually on campus, so you earn a paycheck (usually to cover personal expenses) while attending school. Work-study jobs are awarded as part of your overall financial aid package, but you'll need to check the available openings and apply for jobs.</p></li>
                        <li><p><strong>Student loans</strong> must be repaid (with interest) and are often used to cover expenses that can't be paid for in other ways. Many college loans are set up so you don't need to begin making payments until after you graduate.</p></li>
                    </ul>
                </div>
            </div>

            <!-- Checklist Page -->
            <div id="checklist-page" class="page">
                <h2>Task Checklist</h2>
                <div class="page-content">
                    <div id="checklist-progress-container" style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span id="checklist-progress-label">Progress:</span>
                            <span id="checklist-progress-percent">0%</span>
                        </div>
                        <div style="background: #e0e0e0; border-radius: 8px; height: 16px; margin-top: 6px;">
                            <div id="checklist-progress-bar" style="height: 16px; background: linear-gradient(90deg, #3498db, #6a11cb); border-radius: 8px; width: 0%; transition: width 0.3s;"></div>
                        </div>
                    </div>
                    <div id="checklist-tasks-container"></div>
                </div>
            </div>

            <!-- Notifications Page -->
            <div id="notifications-page" class="page">
                <h2>Notifications</h2>
                <div class="page-content">
                    <div class="notification-list">
                        <div class="notification-item">
                            <i class="fas fa-user-plus"></i>
                            <div class="notification-content">
                                <h3>New Connection</h3>
                                <p>Alex Johnson sent you a connection request</p>
                            </div>
                            <div class="notification-time">10m ago</div>
                        </div>
                        <div class="notification-item">
                            <i class="fas fa-calendar-alt"></i>
                            <div class="notification-content">
                                <h3>Event Reminder</h3>
                                <p>Team meeting starts in 30 minutes</p>
                            </div>
                            <div class="notification-time">1h ago</div>
                        </div>
                        <div class="notification-item">
                            <i class="fas fa-sync-alt"></i>
                            <div class="notification-content">
                                <h3>App Update</h3>
                                <p>Version 2.3 is now available</p>
                            </div>
                            <div class="notification-time">3h ago</div>
                        </div>
                        <div class="notification-item">
                            <i class="fas fa-thumbs-up"></i>
                            <div class="notification-content">
                                <h3>Like Received</h3>
                                <p>Sarah liked your recent post</p>
                            </div>
                            <div class="notification-time">5h ago</div>
                        </div>
                        <div class="notification-item">
                            <i class="fas fa-comment"></i>
                            <div class="notification-content">
                                <h3>New Comment</h3>
                                <p>Mike commented on your project</p>
                            </div>
                            <div class="notification-time">1d ago</div>
                        </div>
                        <div class="notification-item">
                            <i class="fas fa-bell"></i>
                            <div class="notification-content">
                                <h3>Weekly Report</h3>
                                <p>Your weekly productivity report is ready</p>
                            </div>
                            <div class="notification-time">2d ago</div>
                        </div>
                        <div class="notification-item">
                            <i class="fas fa-trophy"></i>
                            <div class="notification-content">
                                <h3>Achievement</h3>
                                <p>You've reached level 5 in our rewards program</p>
                            </div>
                            <div class="notification-time">3d ago</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Page (was login page) -->
            <div id="profile-page" class="page">
                <h2>Profile</h2>
                <div class="page-content">
                    <div class="profile-section">
                        <div class="profile-avatar" style="text-align:center; margin-bottom:20px;">
                            <img src="img/icanlogo.jpg" alt="Profile" style="width:80px; height:80px; border-radius:50%; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
                        </div>
                        <div class="profile-info" style="text-align:center; margin-bottom: 24px;">
                            <h3 id="profile-fullname">John Doe</h3>
                            <p id="profile-email">john.doe@email.com</p>
                        </div>
                        <form id="profile-form" style="max-width: 350px; margin: 0 auto;">
                            <div class="form-group">
                                <label for="profile-grade">Grade Level</label>
                                <select id="profile-grade" class="form-control">
                                    <option>9th</option>
                                    <option>10th</option>
                                    <option>11th</option>
                                    <option>12th</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="profile-gradyear">Graduation Year</label>
                                <select id="profile-gradyear" class="form-control">
                                    <option>2026</option>
                                    <option>2027</option>
                                    <option>2028</option>
                                    <option>2029</option>
                                    <option>2030</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="profile-school">School Name</label>
                                <input type="text" id="profile-school" class="form-control" placeholder="Enter your school name">
                            </div>
                            <button type="button" id="profile-save" class="btn" style="margin-top:16px">
                                Save profile
                            </button>
                        </form>
                        <button id="auth-toggle-btn" class="btn" style="margin-top:20px;"></button>
                    </div>
                </div>
            </div>

            <!-- Create Account Page -->
            <div id="create-account-page" class="page">
                <h2>Create Account</h2>
                <div class="page-content">
                    <form id="create-account-form" class="create-account-form">
                        <div class="form-group">
                            <label for="ca-email">Email</label>
                            <input type="text" id="ca-email" class="form-control" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label for="ca-password">Password</label>
                            <input type="password" id="ca-password" class="form-control" placeholder="Enter password" required>
                        </div>
                        <div class="form-group">
                            <label for="ca-confirm">Confirm Password</label>
                            <input type="password" id="ca-confirm" class="form-control" placeholder="Confirm password" required>
                        </div>
                        <div class="form-group">
                            <label for="ca-fullname">Full Name</label>
                            <input type="text" id="ca-fullname" class="form-control" placeholder="Enter your full name" required>
                        </div>
                        <div class="form-group">
                            <label for="ca-grade">Grade Level</label>
                            <select id="ca-grade" class="form-control">
                                <option>9th</option>
                                <option>10th</option>
                                <option>11th</option>
                                <option>12th</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ca-gradyear">Graduation Year</label>
                            <select id="ca-gradyear" class="form-control">
                                <option>2026</option>
                                <option>2027</option>
                                <option>2028</option>
                                <option>2029</option>
                                <option>2030</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ca-school">School Name</label>
                            <input type="text" id="ca-school" class="form-control" placeholder="Enter your school name">
                        </div>
                        <button type="submit" class="btn">Create Account</button>
                        <button type="button" id="ca-cancel" class="btn" style="background:#eee; color:#333; margin-top:10px;">Cancel</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Tab Bar -->
        <div class="tab-bar">
            <div class="tab" data-page="home-page">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </div>
            <div class="tab" data-page="checklist-page">
                <i class="fas fa-tasks"></i>
                <span>Checklist</span>
            </div>
            <div class="tab" data-page="notifications-page">
                <i class="fas fa-bell"></i>
                <span>Alerts</span>
            </div>
            <div class="tab" data-page="profile-page">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </div>
        </div>

      
    </div>

    <script src="https://cdn.jsdelivr.net/npm/dayjs/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs/plugin/relativeTime.js"></script>
    <script>dayjs.extend(dayjs_plugin_relativeTime);</script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://gpedhjqcomngkharrsep.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdwZWRoanFjb21uZ2toYXJyc2VwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3MzM2MTUsImV4cCI6MjA2ODMwOTYxNX0.pWN3ca99pbJQsLzDtjS162xGS5IB9-9BNUz9eL9V4hg';
        
        // Initialize Supabase client
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        document.addEventListener('DOMContentLoaded', function() {
            /* -----------------------------------------------------------
            APP START-UP  – decide which page to show
            ----------------------------------------------------------- */
            (async () => {
            const { data: { session } } = await supabaseClient.auth.getSession()

            if (session) {
                // There is a remembered login
                activatePage('home-page')          // land on Home
                await hydrateProfile(session.user) // fill the profile UI
                renderChecklist()                  // load completed items
                updateAuthToggle()                 // sets Log-out button
            } else {
                // No stored session – stay on login page (already active)
                updateAuthToggle()                 // sets Log-in button
            }
            })()
            // Tab navigation functionality
            const tabs = document.querySelectorAll('.tab');
            const pages = document.querySelectorAll('.page');
            
            function activatePage(targetPageId) {
                tabs.forEach(t => t.classList.remove('active'));
                pages.forEach(p => p.classList.remove('active'));
                const tab = document.querySelector('.tab[data-page="' + targetPageId + '"]');
                if (tab) tab.classList.add('active');
                const page = document.getElementById(targetPageId);
                if (page) page.classList.add('active');
                // Attach info card listeners if Home is shown
                if (targetPageId === 'home-page') {
                    attachInfoCardListeners();
                }
                // Render checklist if Checklist is shown
                if (targetPageId === 'checklist-page') {
                    renderChecklist();
                }
                if (targetPageId === 'notifications-page') {
                    renderNotifications()
                }
            }
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetPageId = this.getAttribute('data-page');
                    activatePage(targetPageId);
                });
            });
            
            // Login functionality
            const loginForm = document.getElementById('login-form');
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                if (!email || !password) {
                    alert('Please enter both email and password.');
                    return;
                }
                // Supabase sign in
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email,
                    password
                });
                if (error) {
                    alert('Login error: ' + error.message);
                    return;
                }
                alert(`Welcome back, ${email}! You are now logged in.`);
                loginForm.reset();
                document.getElementById('login-page').classList.remove('active');
                activatePage('home-page');
                updateAuthToggle(); 

                if (data && data.user) {
                    // First, get the profile data from profiles table
                    const { data: profileData, error: profileError } = await supabaseClient
                        .from('profiles')
                        .select('*')
                        .eq('id', data.user.id)
                        .single();
                        
                    if (profileError) {
                        console.error('Error fetching profile data:', profileError);
                    } else if (profileData) {
                        // Update UI with profile data
                        document.getElementById('profile-fullname').textContent = profileData.fullname;
                        document.getElementById('profile-email').textContent = profileData.email || email;
                        
                        // Use profile data to update form fields
                        if (profileData.grade) document.getElementById('profile-grade').value = profileData.grade;
                        if (profileData.gradyear) document.getElementById('profile-gradyear').value = profileData.gradyear;
                        if (profileData.school) document.getElementById('profile-school').value = profileData.school;
                        
                        // Add any other profile fields you have in your table
                        // For example:
                        // if (profileData.full_name) document.getElementById('profile-full-name').value = profileData.full_name;
                        // if (profileData.bio) document.getElementById('profile-bio').value = profileData.bio;
                    }
                }

            });
            
            // Social login buttons
            const socialIcons = document.querySelectorAll('.social-icon');
            socialIcons.forEach(icon => {
                icon.addEventListener('click', function() {
                    const platform = this.classList[1];
                    alert(`Login with ${platform.charAt(0).toUpperCase() + platform.slice(1)} clicked`);
                });
            });
            
            // Info card click navigation (attach listeners every time Home is shown)
            function attachInfoCardListeners() {
                document.querySelectorAll('.info-card').forEach(card => {
                    // Remove previous listeners by cloning the node
                    const newCard = card.cloneNode(true);
                    card.parentNode.replaceChild(newCard, card);
                    newCard.addEventListener('click', function() {
                        // Hide all pages
                        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                        // Remove active from all tabs
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        // Show the info page
                        const info = newCard.getAttribute('data-info');
                        document.getElementById(info + '-info-page').classList.add('active');
                    });
                });
            }

            // Checklist data for all grades
            const checklistData = {
                '9th': {
                    'August': [
                        'Schedule a planning session with ICAN',
                        'Attend an ICAN Freshman Transition event or stream online',
                        "Sign up for ICAN's Tip of the Week",
                        'Stay organized with a planner or planning app'
                    ],
                    'September': [
                        'Get involved with extracurriculars and track them with an activities resume',
                        'Attend the Golden Circle College & Career Fair',
                        'Explore career assessments',
                        'Ask adults what they like or dislike about their careers. Find out what type of education or training is required for their jobs.'
                    ],
                    'October': [
                        'Explore your interests and connect to potential careers with a career assessment',
                        'Explore education and training options. Visit college raptor.com to explore four-year options.',
                        "Explore Iowa's technical and two-year programs by visiting ICANsucceed.org/CTEoptions",
                        'Learn about apprenticeship programs by visiting ICANsucceed.org/careertraining'
                    ],
                    'November': [
                        'Talk with parents about future plans including personal and academic goals',
                        'Meet with your school counselor about course selection',
                        'Read regularly to develop strong vocabulary'
                    ],
                    'December': [
                        'Learn computer applications(Word, Excel, etc.)',
                        'Research 3 careers and related training programs',
                        'Volunteer in your community. Some scholarships are based on community service'
                    ],
                    'January': [
                        'Learn about types of financial aid. Visit www.icansucceed.org/payforcollege',
                        'Compare career pathways and explore skill building at ICANsucceed.org/career-planning',
                        'Make sure you have a plan to save. Talk to your parents about a college savings plan or open an account at your bank'
                    ],
                    'February': [
                        'Research high-growth jobs and their required training',
                        'Choose 10th-grade classes with counselor',
                        'Identify job shadow options. Your school counselor can help.'
                    ],
                    'March': [
                        'Find summer camps in your area of interest',
                        'Keep GPA strong - freshman classes count and can impact admission and scholarships',
                        'Attend the Future Ready career & college Fair'
                    ],
                    'April': [
                        'Talk to seniors about their planning process and how they made their decisions',
                        'Visit a college campus or take a virtual tour',
                        'Build relationships for future letters of recommendation'
                    ],
                    'May': [
                        'Job shadow, volunteer, or intern',
                        'Start a summer reading list',
                        'Learn about athletic requirements if you want to play sports in college'
                    ],
                    'June': [
                        'Experience a college campus this summer via an event or summer camp',
                        'Create an activities resume - ICANsucceed.org/activitiesresume',
                        'Talk to adults about their career choices'
                    ],
                    'July': [
                        'Review career assessment and explore matching colleges',
                        'Join hobbies tied to career interests',
                        'Stay open to changing goals'
                    ]
                },
                '10th': {
                    'August': [
                        'Visit ICAN Center for career/college planning',
                        'Sign up for ICAN Tip of the Week',
                        'Plan to attend a college fair this fall',
                        'Get involved and find an activity you enjoy'
                    ],
                    'September': [
                        'Attend Golden Circle College and Career Fair',
                        'Talk to you school counselor about taking the PreACT or PSAT/NMSQT. Register if interested.',
                        'Meet with college representatives or career speakers visting your high school',
                        'Explore careers through a job shadow'
                    ],
                    'October': [
                        'Compare careers and research job characteristics',
                        'If the military interests you, now is the time to explore military education benefits',
                        'Find a mentor to assist with your planning process'
                    ],
                    'November': [
                        'Discuss admission requirements with counselor',
                        'Explore tuition and financial aid options',
                        'Talk to adults about their careers'
                    ],
                    'December': [
                        'Update your extracurriculars and community service in your activities resume (due Date 12/31)',
                        'Schedule advising session with ICAN (due date - 12/31)',
                        'Learn about sticker price and net price for college',
                        'Volunteer over winter break (Due Date - 12/31)'
                    ],
                    'January': [
                        'Take a career or personality assessment (Due Date - 1/31)',
                        'Meet with your counselor about junior year classes',
                        'Review financial plan for post-high school'
                    ],
                    'February': [
                        'Attend ICAN planning nights',
                        'Confirm junior year classes align with your career path',
                        'Explore career pathways using MyACT',
                        'Learn about AP and college credit classes options'
                    ],
                    'March': [
                        'Schedule college tours for summer break',
                        'Attend ICAN Future Ready Fair',
                        'Talk to professionals in your field of interest'
                    ],
                    'April': [
                        'Review college financial plan',
                        'Explore scholarships and savings strategies',
                        'Gain experience via job shadowing or internships',
                        'Learn about Return on Investment for different career paths'
                    ],
                    'May': [
                        'Check status of savings plans',
                        'Ask counselor about summer programs',
                        'Look for summer jobs related to your interests'
                    ],
                    'June': [
                        'Keep reading over the summer',
                        'Join hobbies that develop career interests',
                        'Learn about athletic eligibility for college if interested'
                    ],
                    'July': [
                        'Tour college campuses during camp visits',
                        'Talk to parents about cost planning',
                        'Maintain connections for future recommendations'
                    ]
                },
                '11th': {
                    'August': [
                        'Sign up for ICAN Tip of the Week - Learn more (ICANsucceed.org/signup)',
                        'Learn about college fairs/events (Learn More - ICANsucceed.org/collegefairs)',
                        'Keep GPA up - every class counts for admission and scholarship',
                        'Review/start a savings plan',
                        'Take a career assessment  Learn more (ICANsucceed.org/career-planning) (Due Date - 8/31)',
                        'Talk to parents about careers'
                    ],
                    'September': [
                        'Attend the Golden Circle College & Career Fair (Due Date - 9/21) Learn more - ICANsucceed.org/goldencircle',
                        'Register for the PSAT/NMSQT',
                        'Explore military and apprenticeship options  Learn more (ICANsucceed.org/militaryoptions)',
                        'Schedule ICAN advising session to review your plan (ICANsucceed.org/apt) Due Date - 9/30'
                    ],
                    'October': [
                        'Attend college/career fairs',
                        'Explore Iowa colleges',
                        'Talk with your counselor about admission readiness'
                    ],
                    'November': [
                        'Review college brochures',
                        'Make a list of 10–15 colleges',
                        'Download the College Checklist  (ICANsucceed.org/materials)',
                        'Start SAT/ACT planning'
                    ],
                    'December': [
                        'Register for January SAT or February ACT (Due Date is registration deadline)',
                        'Meet with college reps/career speakers',
                        'Use CollegeRaptor.com to compare colleges',
                        'Research scholarships (Due Date - Dec 31) Learn more - ICANsucceed.org/scholarships'
                    ],
                    'January': [
                        'Register for March SAT (Due Date would be the registration ddeadline each year)',
                        'Meet with college reps/career speakers',
                        'Create an education/training budget (studentloan.org/ROCITtool)',
                        'Schedule planning with ICAN (ICANsucceed.org/apt) Due Date  1/31'
                    ],
                    'February': [
                        'Attend a financial aid seminar (Find an event - ICANsucceed.org/events)',
                        'Choose senior classes aligned with your career path (Due Date 2/28)',
                        'Register for April ACT (Due Date is registration deadline)',
                        'Talk about AP/CLEP/honors courses',
                        'Plan campus visits based on \'No School\' days'
                    ],
                    'March': [
                        'Attend the ICAN Future Ready Fair  (Due Date - 3/26) Learn more - ICANsucceed.org/futurereadyfair',
                        'Schedule visits to colleges/apprenticeships',
                        'Register for May SAT (Due Date is registration deadline)',
                        'Consider summer college credit courses or camp activities'
                    ],
                    'April': [
                        'Plan for AP exams',
                        'Go on campus visits. Use the ICAN Campus Visits worksheet to aid in your visit (ICANsucceed.org/materials)',
                        'Compare/rank colleges based on your visits',
                        'Register for June ACT/SAT (Due date is regsitration deadline)'
                    ],
                    'May': [
                        'Narrow top college/apprenticeship choices',
                        'Take AP exams',
                        'Get a career-related summer job',
                        'Update activities resume (Due Date May 31)'
                    ],
                    'June': [
                        'Schedule final campus visits',
                        'Start private scholarship applications  (ICANsucceed.org/scholarships)',
                        'Save money for college',
                        'Review athletic requirements (if applicable)'
                    ],
                    'July': [
                        'Review admission application requirements (Due date 7/31)',
                        'Request letters of recommendation',
                        'Create a spending plan with parents'
                    ]
                },
                '12th': {
                    'August': [
                        'Sign up for ICAN Senior Alerts (Due 9/1) ICANsucceed.org/signup',
                        'Begin application essays and recommendation requests',
                        'Research deadlines for scholarships and financial aid',
                        'Talk to admissions reps about retaking SAT/ACT',
                        'Register for placement and entrance exams (Due date is regsitration deadlines)',
                        'Create a StudentAid.gov account  (Due Date 9/30) Link should be studentaid.gov'
                    ],
                    'September': [
                        'Schedule ICAN college/career planning session (Due date9/31) ICANsucceed.org/apt',
                        'Begin submitting admission applications. (Due Date Nov 1)',
                        'Update activities resume (Due Date 10/1) ICANsucceed.org/activitiesresume',
                        'Schedule your FAFSA appointment with ICAN (Due Date: 10/15) ICANsucceed.org/apt',
                        'Gather needed documents for FAFSA completion Due date ; Oct 1 (ICANsucceed.org/whattobring)'
                    ],
                    'October': [
                        'Sumbit your FAFSA between Oct 1 and your earliest priority date. Learn about priority dates at ICANsucceed.org/priority',
                        'Schedule FAFSA completion appointment (Due Date 10/31) ICAnsucceed.org/apt',
                        'Submit admissions and scholarship apps by Nov 1',
                        'Research military benefits (ICANsucceed.org/militaryoptions)',
                        'Find FAFSA assistance events near you (ICANsucceed.org/FAFSAreadyiaevents)'
                    ],
                    'November': [
                        'Finalize and submit applications (Due date Nov 15)',
                        'Start free scholarship searches (ICANsucceed.org/scholarships)',
                        'Set up StudentAid.gov account (if not done) (Studentaid.gov) Due Date 11/15',
                        'Stay focused on grades. Senior year grades guarantee admission to college',
                        'Register for December ACT (Due date is regsitration deadline)'
                    ],
                    'December': [
                        'Check with counselor on local/state scholarships',
                        'Monitor for acceptance letters',
                        'Research additional financial aid options',
                        'Upon FAFSA submission, watch for your FAFSA Submission Summary',
                        'Create a plan to finance college - studentloan.org/gameplan'
                    ],
                    'January': [
                        'Schedule a financial aid package review session with ICAN - ICANsucceed.org/apt (Due Date - 4/1)',
                        "If you still haven't filed the FAFSA, get it submitted ASAP",
                        'Ask your counselor to send first semester transcripts',
                        'Submit your houseing applications'
                    ],
                    'February': [
                        'Determine if you need to submit additional paperwork for financial aid to each college',
                        'Maintain strong grades. Second semester grades are important and can impact scholarship eligibility and admission',
                        'Continue applying for scholarships and grants - ICANsucceed.org/scholarships'
                    ],
                    'March': [
                        'Use College Funding Forecaster to outline your plan to cover college costs - studentloan.org/forecaster',
                        'Meet with ICAN to review your financial aid packages (ICANsucceed.org/apt) Due date: 4/15',
                        'Heading to an apprenticeship? Make connections to determine next steps (ICANsucceed.org/career-training)'
                    ],
                    'April': [
                        'Prepare for May 1 Decision Day',
                        'Create/review budget with parents',
                        'Notify other colleges if not attending'
                    ],
                    'May': [
                        'Take AP/CLEP exams',
                        'Finalize summer job plans',
                        'Ask counselor to submit final transcripts',
                        'Return all documents to your college',
                        'Notify college of scholarships'
                    ],
                    'June': [
                        'Confirm tools/certifications for apprenticeships',
                        'Attend orientation',
                        'Thank your support network',
                        'Complete loan paperwork'
                    ],
                    'July': [
                        'Use ICAN\'s Packing List  (ICANsucceed.org/materials)',
                        'Coordinate with roommate',
                        'Renew FAFSA for following year'
                    ]
                }
            };

            function getSelectedGrade() {
                const gradeSelect = document.getElementById('profile-grade');
                return gradeSelect ? gradeSelect.value : '9th';
            }

            async function renderChecklist () {
                const grade       = getSelectedGrade()
                const gradeData   = checklistData[grade]
                const container   = document.getElementById('checklist-tasks-container')
                container.innerHTML = ''

                /* load saved list; never throws */
                const completedList = await loadChecklist()

                /* build UI */
                Object.entries(gradeData).forEach(([month, tasks]) => {
                    const monthDiv   = document.createElement('div')
                    monthDiv.className = 'checklist-month'

                    const monthTitle = document.createElement('h3')
                    monthTitle.textContent = month
                    monthDiv.appendChild(monthTitle)

                    tasks.forEach(task => {
                    const itemDiv  = document.createElement('div')
                    itemDiv.className = 'task-item'

                    const cb       = document.createElement('input')
                    cb.type = 'checkbox'

                    const content  = document.createElement('div')
                    content.className = 'task-content'

                    const h3       = document.createElement('h3')
                    h3.textContent = task
                    content.appendChild(h3)

                    /* mark checked if in saved list */
                    if (completedList.some(t => t.task === task)) {
                        cb.checked = true
                        itemDiv.classList.add('completed')
                    }

                    /* change handler */
                    cb.addEventListener('change', async () => {
                        itemDiv.classList.toggle('completed', cb.checked)
                        updateProgress()

                        let current = await loadChecklist()   // still safe
                        if (cb.checked) {
                        if (!current.some(t => t.task === task)) {
                            current.push({ task, completed_at: new Date().toISOString() })
                        }
                        } else {
                        current = current.filter(t => t.task !== task)
                        }
                        current.sort((a, b) => new Date(a.completed_at) - new Date(b.completed_at))
                        await saveChecklist(current)
                    })

                    itemDiv.appendChild(cb)
                    itemDiv.appendChild(content)
                    monthDiv.appendChild(itemDiv)
                    })

                    container.appendChild(monthDiv)
                })

                updateProgress()
                }
                
                function updateProgress() {
                const checkboxes = document.querySelectorAll('#checklist-tasks-container input[type="checkbox"]');
                const total = checkboxes.length;
                const completed = Array.from(checkboxes).filter(cb => cb.checked).length;
                const percent = total > 0 ? Math.round((completed / total) * 100) : 0;
                
                document.getElementById('checklist-progress-bar').style.width = percent + '%';
                document.getElementById('checklist-progress-percent').textContent = percent + '%';
            }
            
            // Listen for grade changes
            const gradeSelect = document.getElementById('profile-grade');
            if (gradeSelect) {
                gradeSelect.addEventListener('change', function() {
                    renderChecklist();
                });
            }


            // On DOMContentLoaded, if Home is visible, attach listeners
            if (document.getElementById('home-page').classList.contains('active')) {
                attachInfoCardListeners();
            }
            
            // Initialize checklist on page load
            renderChecklist();

            // Show modal on link click
            const createAccountLink = document.querySelector('.additional-options a[href="#"]:nth-child(2)');
            if (createAccountLink) {
                createAccountLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    // Hide all pages
                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                    // Show create account page
                    document.getElementById('create-account-page').classList.add('active');
                });
            }
            // Handle Create Account form submit
            const caForm = document.getElementById('create-account-form');
            if (caForm) {
                caForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const email = document.getElementById('ca-email').value;
                    const password = document.getElementById('ca-password').value;
                    const confirm = document.getElementById('ca-confirm').value;
                    const fullname = document.getElementById('ca-fullname').value;
                    const grade = document.getElementById('ca-grade').value;
                    const gradyear = document.getElementById('ca-gradyear').value;
                    const school = document.getElementById('ca-school').value;
                    if (!email || !password || !confirm) {
                        alert('Please fill all required fields.');
                        return;
                    }
                    if (password !== confirm) {
                        alert('Passwords do not match.');
                        return;
                    }
                    // Supabase sign up
                    const { data, error } = await supabaseClient.auth.signUp({
                        email,
                        password,
                        options: {
                            data: { fullname, grade, gradyear, school }
                        }
                    });
                    if (error) {
                        alert('Sign up error: ' + error.message);
                        return;
                    }
                    caForm.reset();
                    alert('Account created! Please check your email to confirm your account.');
                    // Optionally, redirect to login page
                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                    document.getElementById('login-page').classList.add('active');
                });
            }
            // Cancel button returns to login page
            const caCancelBtn = document.getElementById('ca-cancel');
            if (caCancelBtn) {
                caCancelBtn.addEventListener('click', function() {
                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                    document.getElementById('login-page').classList.add('active');
                });
            }

            /* ---------- SAFE HELPERS ---------- */

            /* returns `user` or null – never throws */
            async function getCurrentUser () {
            const { data, error } = await supabaseClient.auth.getUser()
            if (error) {                   // network or Supabase SDK error
                console.error(error)
                return null
            }
            return data?.user ?? null
            }

            /* always resolves to an array (may be empty) */
            async function loadChecklist () {
            const user = await getCurrentUser()
            if (!user) return []           // not signed in → nothing completed yet

            const { data, error } = await supabaseClient
                .from('checklists')
                .select('data')
                .eq('user_id', user.id)
                .single()

            if (error && error.code !== 'PGRST116') {
                console.error(error)
                return []
            }
            return data ? data.data : []
            }

            /* skip save if not signed in; log errors */
            async function saveChecklist(updatedArray) {
            const user = await getCurrentUser();
            if (!user) return;            // no user → silently ignore

            // how many tasks exist for the selected grade
            const totalTasks = Object
                .values(checklistData[getSelectedGrade()])
                .reduce((sum, arr) => sum + arr.length, 0);

            const completed = updatedArray.length;   // ← the array passed in

            const { error } = await supabaseClient
                .from('checklists')
                .upsert(
                {
                    user_id : user.id,
                    email   : user.email,
                    data    : updatedArray,            // ← correct variable
                    progress: `${completed}/${totalTasks}`
                },
                { onConflict: 'user_id' }            // works because you already
                );                                     // have the unique constraint

            if (error) console.error(error);
            }

            async function fetchNotifications () {
                const { data, error } = await supabaseClient
                    .from('notifications')
                    .select('id, title, body, created_at')
                    .order('created_at', { ascending: false })
                if (error) throw error
                return data
            }

            async function renderNotifications() {
                const list = document.querySelector('.notification-list')
                list.innerHTML = ''                       // clear previous
                const rows = await fetchNotifications()   // newest→oldest
                rows.forEach(n => {
                    const item  = document.createElement('div')
                    item.className = 'notification-item'
                    item.innerHTML = `
                    <img src="img/icanlogo.jpg" style="width: 15%; height: 15%; object-fit: contain; margin-right: 4%;">
                    <div class="notification-content">
                        <h3>${n.title}</h3>
                        <p>${n.body ?? ''}</p>
                    </div>
                    <div class="notification-time">${dayjs(n.created_at).fromNow()}</div>
                    `
                    list.appendChild(item)
                })
            }

            async function hydrateProfile(user) {
                const { data: profile, error } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .eq('id', user.id)
                    .single()
                if (error) { console.error(error); return }
                document.getElementById('profile-fullname').textContent = profile.fullname
                document.getElementById('profile-email').textContent    = profile.email
                if (profile.grade)    document.getElementById('profile-grade').value    = profile.grade
                if (profile.gradyear) document.getElementById('profile-gradyear').value = profile.gradyear
                if (profile.school)   document.getElementById('profile-school').value   = profile.school
            }

            /* button in profile page that toggles between Log in / Log out */
            function resetProfileUI () {
                document.getElementById('profile-fullname').textContent = 'John Doe';
                document.getElementById('profile-email').textContent    = 'john.doe@email.com';
                const gradeEl = document.getElementById('profile-grade');
                if (gradeEl) gradeEl.value = '9th';
                const gradYearEl = document.getElementById('profile-gradyear');
                if (gradYearEl) gradYearEl.value = '2026';
                const schoolEl = document.getElementById('profile-school');
                if (schoolEl) schoolEl.value = '';
            }

            async function updateProfile () {
                const user = (await supabaseClient.auth.getSession()).data.session?.user
                if (!user) { alert('You must be logged in'); return }

                const updates = {
                    id:       user.id,                                // primary-key column
                    email:    user.email,                            
                    fullname: document.getElementById('profile-fullname').textContent,
                    grade:    document.getElementById('profile-grade').value,
                    gradyear: document.getElementById('profile-gradyear').value,
                    school:   document.getElementById('profile-school').value
    
                }

                const { error } = await supabaseClient
                        .from('profiles')
                        .upsert(updates, { onConflict: 'id' })        // one row per user

                if (error) {
                    console.error(error)
                    alert('Could not save profile')
                } else {
                    alert('Profile saved')
                }
            }

            document.getElementById('profile-save')
                    .addEventListener('click', updateProfile)

            async function updateAuthToggle () {
                const btn   = document.getElementById('auth-toggle-btn')
                const user  = (await supabaseClient.auth.getSession()).data.session?.user
                if (!btn) return
                if (user) {
                    btn.textContent = 'Log out'
                    btn.onclick = async () => {
                      await supabaseClient.auth.signOut()

                        resetProfileUI()          // ← clears profile page
                        renderChecklist()         // ← fresh, no items checked
                        activatePage('login-page')
                        updateAuthToggle()
                    }
                } else {
                    btn.textContent = 'Log in'
                    btn.onclick = () => activatePage('login-page')
                }
            }

            
        });
    </script>
</body>
</html>